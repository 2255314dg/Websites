{% extends 'dashboard/base.html' %}

{% block title %}编辑学生 - {{ student.name }} - 学生返校数据仪表盘{% endblock %}

{% block content %}
    <!-- Dashboard Header -->
    <header class="dashboard-header pt-5 mt-5">
        <div class="container">
            <h1><i class="fa fa-pencil"></i> 编辑学生信息</h1>
            <p>修改学生{{ student.name }}的返校信息</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mt-4">
        <!-- Back Button -->
        <div class="mb-4">
            <a href="{% url 'student_detail' student.id %}" class="btn btn-secondary">
                <i class="fa fa-arrow-left"></i> 返回学生详情
            </a>
        </div>

        <!-- Edit Form Card -->
        <div class="card fade-in">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0"><i class="fa fa-edit"></i> 编辑学生信息</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Basic Information Section -->
                    <div class="mb-4">
                        <h5><i class="fa fa-user-circle"></i> 基本信息</h5>
                        <hr>
                        
                        <div class="row mb-3">
                            <label for="studentId" class="col-sm-2 col-form-label">学号</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="studentId" value="{{ student.student_id }}" readonly>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="name" class="col-sm-2 col-form-label">姓名</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="name" name="name" value="{{ student.name }}" required>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label class="col-sm-2 col-form-label">性别</label>
                            <div class="col-sm-10">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="male" value="male" {% if student.gender == 'male' %}checked{% endif %} required>
                                    <label class="form-check-label" for="male">男</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="female" value="female" {% if student.gender == 'female' %}checked{% endif %} required>
                                    <label class="form-check-label" for="female">女</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="classStatus" class="col-sm-2 col-form-label">年级</label>
                            <div class="col-sm-10">
                                <select class="form-select" id="classStatus" name="class_status" required>
                                    <option value="freshman" {% if student.class_status == 'freshman' %}selected{% endif %}>大一</option>
                                    <option value="sophomore" {% if student.class_status == 'sophomore' %}selected{% endif %}>大二</option>
                                    <option value="junior" {% if student.class_status == 'junior' %}selected{% endif %}>大三</option>
                                    <option value="senior" {% if student.class_status == 'senior' %}selected{% endif %}>大四</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="major" class="col-sm-2 col-form-label">专业</label>
                            <div class="col-sm-10">
                                <select class="form-select" id="major" name="major" required>
                                    <option value="computer" {% if student.major == 'computer' %}selected{% endif %}>计算机科学与技术</option>
                                    <option value="electronics" {% if student.major == 'electronics' %}selected{% endif %}>电子信息工程</option>
                                    <option value="mechanical" {% if student.major == 'mechanical' %}selected{% endif %}>机械工程</option>
                                    <option value="civil" {% if student.major == 'civil' %}selected{% endif %}>土木工程</option>
                                    <option value="business" {% if student.major == 'business' %}selected{% endif %}>工商管理</option>
                                    <option value="medicine" {% if student.major == 'medicine' %}selected{% endif %}>临床医学</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="contact" class="col-sm-2 col-form-label">联系电话</label>
                            <div class="col-sm-10">
                                <input type="tel" class="form-control" id="contact" name="contact" pattern="^1[3-9]\d{9}$" placeholder="请输入11位手机号码" value="{{ student.contact }}" required>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="remarks" class="col-sm-2 col-form-label">备注</label>
                            <div class="col-sm-10">
                                <textarea class="form-control" id="remarks" name="remarks" rows="3" placeholder="可选：添加学生备注信息">{{ student.remarks }}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Return Information Section -->
                    <div class="mb-4">
                        <h5><i class="fa fa-home"></i> 返校信息</h5>
                        <hr>
                        
                        <div class="row mb-3">
                            <label for="returnStatus" class="col-sm-2 col-form-label">返校状态</label>
                            <div class="col-sm-10">
                                <select class="form-select" id="returnStatus" name="return_status" required>
                                    <option value="returned" {% if student.return_status == 'returned' %}selected{% endif %}>已返校</option>
                                    <option value="not_returned" {% if student.return_status == 'not_returned' %}selected{% endif %}>未返校</option>
                                    <option value="delayed" {% if student.return_status == 'delayed' %}selected{% endif %}>延期返校</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="returnTime" class="col-sm-2 col-form-label">返校时间</label>
                            <div class="col-sm-10">
                                <input type="datetime-local" class="form-control" id="returnTime" name="return_time" 
                                       value="{% if student.return_time %}{{ student.return_time|date:'Y-m-d\TH:i' }}{% else %}{% endif %}">
                                <div class="form-text">未返校学生可留空</div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label for="returnMethod" class="col-sm-2 col-form-label">返校方式</label>
                            <div class="col-sm-10">
                                <select class="form-select" id="returnMethod" name="return_method">
                                    <option value="" {% if not student.return_method %}selected{% endif %}>请选择</option>
                                    <option value="train" {% if student.return_method == 'train' %}selected{% endif %}>火车</option>
                                    <option value="plane" {% if student.return_method == 'plane' %}selected{% endif %}>飞机</option>
                                    <option value="bus" {% if student.return_method == 'bus' %}selected{% endif %}>汽车</option>
                                    <option value="private_car" {% if student.return_method == 'private_car' %}selected{% endif %}>私家车</option>
                                    <option value="other" {% if student.return_method == 'other' %}selected{% endif %}>其他</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg me-3">
                            <i class="fa fa-save"></i> 保存更改
                        </button>
                        <a href="{% url 'student_detail' student.id %}" class="btn btn-secondary btn-lg">
                            <i class="fa fa-times"></i> 取消
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    {% block extra_js %}
    <script>
        // Form Validation and Enhancement
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const returnStatus = document.getElementById('returnStatus');
            const returnTime = document.getElementById('returnTime');
            const returnMethod = document.getElementById('returnMethod');
            
            // Add return time and method requirements based on return status
            returnStatus.addEventListener('change', function() {
                if (this.value === 'returned') {
                    returnTime.required = true;
                    returnMethod.required = true;
                } else {
                    returnTime.required = false;
                    returnMethod.required = false;
                }
            });
            
            // Trigger initial check
            returnStatus.dispatchEvent(new Event('change'));
            
            // Form submission confirmation
            form.addEventListener('submit', function(e) {
                if (!confirm('确定要保存更改吗？')) {
                    e.preventDefault();
                }
            });
        });
    </script>
    {% endblock %}
{% endblock %}